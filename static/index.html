<!DOCTYPE html>
<html lang="en">
<head>
  <title>Run Python Code</title>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/ace/1.4.14/ace.js" integrity="sha512-..." crossorigin="anonymous"></script>
  <style>
    #editor { height: 300px; width: 600px; }
    #output { white-space: pre-wrap; border: 1px solid #ccc; padding: 10px; margin-top: 10px; }
    #problem, #test-cases { width: 600px; margin-bottom: 10px; }
  </style>
</head>
<body>
  <h1>Python Code Executor</h1>
  
  <label for="problem">Problem Statement:</label>
  <div id="problem"></div><br>
  
  <label for="test-cases">Test Cases:</label>
  <div id="test-cases"></div><br>
  
  <div id="editor"></div>
  <button onclick="runCode()">Run</button>
  <div id="output"></div>

  <script>
    var editor = ace.edit("editor");
    editor.setTheme("ace/theme/monokai");
    editor.session.setMode("ace/mode/python");

    function runCode() {
      var code = editor.getValue();
      var testCases = document.getElementById('test-cases').dataset.testCases;
      testCases = JSON.parse(testCases);
      
      fetch('/run', {
        method: 'POST',
        headers: { 'Content-Type': 'application/json' },
        body: JSON.stringify({ code: code, testCases: testCases })
      })
      .then(response => response.json())
      .then(data => {
        const outputDiv = document.getElementById('output');
        outputDiv.innerHTML = ''; // Clear previous output
        data.results.forEach((result, index) => {
          const resultElement = document.createElement('div');
          resultElement.innerHTML = `
            <strong>Test Case ${index + 1}</strong><br>
            Input: ${result.input}<br>
            Expected Output: ${result.expected}<br>
            Actual Output: ${result.output}<br>
            Passed: ${result.passed ? 'Yes' : 'No'}
            <hr>
          `;
          outputDiv.appendChild(resultElement);
        });
      })
      .catch(error => console.error('Error:', error));
    }

    function loadProblem() {
      fetch('/problems')
      .then(response => response.json())
      .then(data => {
        document.getElementById('problem').textContent = data.problem;
        document.getElementById('test-cases').textContent = data.testCases.map(tc => `Input: ${tc.input}, Expected: ${tc.expected}`).join('\n');
        document.getElementById('test-cases').dataset.testCases = JSON.stringify(data.testCases);
      })
      .catch(error => console.error('Error:', error));
    }

    function loadTemplate() {
      fetch('/template')
      .then(response => response.json())
      .then(data => {
        editor.setValue(data.code, -1); // -1 to move cursor to start
      })
      .catch(error => console.error('Error:', error));
    }

    window.onload = function() {
      loadProblem();
      loadTemplate();
    };
  </script>
</body>
</html>
